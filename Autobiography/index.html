<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trần Thị Kim Chi - Trang Cá Nhân</title>
<link rel="stylesheet" href="styles.css" />
<!-- Icons CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
<!-- Shooting stars container -->
<div id="shooting-stars-container"></div>

<header>
  <h1>Trần Thị Kim Chi</h1>
  <div class="contact-info" aria-label="Thông tin liên hệ">
    Số điện thoại: <a href="tel:0935074853" style="color:#ffc107; text-decoration:none;">0935074853</a> | 
    Email: <a href="mailto:chi23675@gmail.com" style="color:#ffc107; text-decoration:none;">chi23675@gmail.com</a>
  </div>
  <div class="social-links" aria-label="Liên kết mạng xã hội">
    <a href="https://www.facebook.com/eomeoi03/" target="_blank" rel="noopener" title="Facebook"><i class="fab fa-facebook"></i></a>
    <a href="https://github.com/kimcheese23" target="_blank" rel="noopener" title="GitHub"><i class="fab fa-github"></i></a>
  </div>
  <nav aria-label="Menu điều hướng chính">
    <ul>
      <li><a href="#" class="nav-link active" data-target="biography">Tiểu Sử</a></li>
      <li><a href="#" class="nav-link" data-target="projects">Dự Án</a></li>
      <li><a href="#" class="nav-link" data-target="storage">Lưu Trữ Tài Liệu</a></li>
      <li><a href="#" class="nav-link" data-target="upload">Tải Tài Liệu Lên</a></li>
      <li><a href="#" class="nav-link" data-target="games">Trò Chơi</a></li>
    </ul>
  </nav>
</header>

<main>
  <section id="biography" class="active" tabindex="0" aria-label="Tiểu sử cá nhân">
    <h2>Tiểu Sử</h2>
    <p>Xin chào, tôi là <strong>Trần Thị Kim Chi</strong>. Tôi đam mê công nghệ, thiết kế và phát triển web. Qua các dự án và kinh nghiệm của mình, tôi luôn cố gắng tạo ra những sản phẩm sáng tạo và hữu ích. Tôi rất vui được chia sẻ những điều này với bạn tại trang cá nhân của mình.</p>
  </section>
  <section id="projects" tabindex="0" aria-label="Danh sách dự án">
    <h2>Dự Án</h2>
    <ul>
      <li>Website giới thiệu cá nhân tích hợp mini game tương tác</li>
      <li>Ứng dụng quản lý tài liệu cá nhân với giao diện thân thiện</li>
      <li>Game vượt chướng ngại vật đơn giản bằng Canvas và JavaScript</li>
      <li>Hệ thống phản hồi và lưu trữ tài liệu dựa trên trình duyệt</li>
    </ul>
  </section>
  <section id="storage" tabindex="0" aria-label="Lưu trữ tài liệu">
    <h2>Lưu Trữ Tài Liệu</h2>
    <div id="uploaded-files" aria-live="polite">
      <p>Không có tài liệu nào được tải lên.</p>
    </div>
  </section>
  <section id="upload" tabindex="0" aria-label="Tải tài liệu lên">
    <h2>Tải Tài Liệu Lên</h2>
    <div id="upload-section">
      <p>Chọn tập tin để tải lên (chỉ lưu trữ trên trình duyệt).</p>
      <input type="file" id="file-input" aria-label="Chọn tập tin để tải lên" />
      <button id="upload-btn" type="button" aria-label="Nút tải lên">Tải lên</button>
      <p id="upload-status" role="alert" aria-live="polite"></p>
    </div>
  </section>
  <section id="games" tabindex="0" aria-label="Các trò chơi tương tác">
    <h2>Trò Chơi Tương Tác</h2>
    <div id="games">
      <!-- Bubble Pop Game -->
      <div class="game-container" aria-label="Trò chơi chạm bong bóng nổ">
        <h3>Chạm Bong Bóng Nổ</h3>
        <div id="bubble-game" aria-describedby="bubble-desc" tabindex="0" role="application"></div>
        <p id="bubble-desc" class="instructions" style="color:#1e3c72;">Nhấp hoặc chạm vào các bong bóng để tạo tiếng nổ. Bong bóng sẽ nổi lên từ dưới lên.</p>
        <p>Điểm: <span id="bubble-score">0</span></p>
        <button id="bubble-play" type="button" aria-label="Nút chơi trò bong bóng">Chơi</button>
        <button id="bubble-reset" type="button" aria-label="Nút chơi lại trò bong bóng" disabled>Chơi Lại</button>
      </div>

      <!-- Obstacle Game (Mario style) -->
      <div class="game-container" aria-label="Trò chơi vượt chướng ngại vật">
        <h3>Vượt Chướng Ngại Vật (Mario Style)</h3>
        <canvas id="obstacle-canvas" width="460" height="300" role="application" aria-label="Canvas trò chơi vượt chướng ngại vật"></canvas>
        <p class="instructions" style="color:#e0e7ff;">Nhấn phím cách hoặc chạm để nhảy qua cây nấm.</p>
        <p>Điểm: <span id="obstacle-score">0</span></p>
        <button id="obstacle-play" type="button" aria-label="Nút chơi trò vượt chướng ngại vật">Chơi</button>
        <button id="obstacle-reset" type="button" aria-label="Nút chơi lại trò vượt chướng ngại vật" disabled>Chơi Lại</button>
      </div>
    </div>
  </section>
</main>

<!-- Fixed music player at bottom -->
<footer>
  <div id="music-player">
    <label for="music-url">Dán URL YouTube hoặc Spotify để phát nhạc:</label>
    <input type="text" id="music-url" placeholder="Ví dụ: https://www.youtube.com/watch?v=dQw4w9WgXcQ" aria-label="Nhập URL nhạc" />
    <button id="load-music" aria-label="Phát nhạc từ URL">Phát nhạc</button>
    <div id="music-container" aria-live="polite" aria-atomic="true"></div>
  </div>
</footer>

<script>
  // Navigation logic
  const navLinks = document.querySelectorAll('.nav-link');
  const sections = document.querySelectorAll('main > section');

  navLinks.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const target = link.getAttribute('data-target');
      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');
      sections.forEach(section => {
        if(section.id === target) {
          section.classList.add('active');
          section.focus();
        } else {
          section.classList.remove('active');
        }
      });
    });
  });

  // Document Storage and Upload with localStorage
  const fileInput = document.getElementById('file-input');
  const uploadBtn = document.getElementById('upload-btn');
  const uploadedFilesContainer = document.getElementById('uploaded-files');
  const uploadStatus = document.getElementById('upload-status');

  function loadFiles() {
    let files = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
    if(files.length === 0) {
      uploadedFilesContainer.innerHTML = "<p>Không có tài liệu nào được tải lên.</p>";
    } else {
      const ul = document.createElement('ul');
      files.forEach((file, i) => {
        const li = document.createElement('li');
        const span = document.createElement('span');
        span.textContent = file.name;
        const btn = document.createElement('button');
        btn.textContent = 'Xóa';
        btn.setAttribute('aria-label', 'Xóa ' + file.name);
        btn.addEventListener('click', () => {
          files.splice(i,1);
          localStorage.setItem('uploadedFiles', JSON.stringify(files));
          loadFiles();
        });
        li.appendChild(span);
        li.appendChild(btn);
        ul.appendChild(li);
      });
      uploadedFilesContainer.innerHTML = '';
      uploadedFilesContainer.appendChild(ul);
    }
  }

  uploadBtn.addEventListener('click', () => {
    const file = fileInput.files[0];
    if(!file){
      uploadStatus.textContent = 'Vui lòng chọn một tập tin!';
      uploadStatus.style.color = 'red';
      return;
    }
    let files = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
    files.push({name: file.name});
    localStorage.setItem('uploadedFiles', JSON.stringify(files));
    uploadStatus.textContent = 'Tập tin "' + file.name + '" đã được lưu trong trình duyệt.';
    uploadStatus.style.color = 'limegreen';
    fileInput.value = '';
    loadFiles();
  });

  loadFiles();

  // Bubble Pop Game
  const bubbleGame = document.getElementById('bubble-game');
  const bubbleScoreEl = document.getElementById('bubble-score');
  const bubblePlayBtn = document.getElementById('bubble-play');
  const bubbleResetBtn = document.getElementById('bubble-reset');

  let bubbleScore = 0;
  let bubbleInterval;
  let bubbles = [];
  let bubbleRunning = false;

  function createBubble() {
    if (!bubbleRunning) return;
    const bubble = document.createElement('div');
    bubble.classList.add('bubble');
    const size = Math.random() * 40 + 30;
    bubble.style.width = size + 'px';
    bubble.style.height = size + 'px';
    bubble.style.left = Math.random() * (bubbleGame.clientWidth - size) + 'px';
    bubble.style.bottom = '-'+ size + 'px';
    bubble.style.animationDuration = (Math.random()*5 + 5) + 's';
    bubbleGame.appendChild(bubble);

    function popBubble() {
      bubble.removeEventListener('click', popBubble);
      bubble.classList.add('pop');
      bubble.style.pointerEvents = 'none';
      bubbleScore++;
      bubbleScoreEl.textContent = bubbleScore;
      setTimeout(() => {
        if(bubble.parentNode) bubbleGame.removeChild(bubble);
        bubbles = bubbles.filter(b => b !== bubble);
      }, 300);
    }

    bubble.addEventListener('click', popBubble);
    bubbles.push(bubble);

    bubble.addEventListener('animationend', () => {
      if(bubble.parentNode) {
        bubbleGame.removeChild(bubble);
        bubbles = bubbles.filter(b => b !== bubble);
      }
    });
  }

  function startBubbleGame(){
    if(bubbleRunning) return;
    bubbleRunning = true;
    bubbleScore = 0;
    bubbleScoreEl.textContent = bubbleScore;
    bubblePlayBtn.disabled = true;
    bubbleResetBtn.disabled = false;
    bubbleInterval = setInterval(createBubble, 700);
  }

  function stopBubbleGame(){
    bubbleRunning = false;
    bubblePlayBtn.disabled = false;
    bubbleResetBtn.disabled = true;
    clearInterval(bubbleInterval);
    bubbles.forEach(bubble => {
      if(bubble.parentNode) bubbleGame.removeChild(bubble);
    });
    bubbles = [];
  }

  bubblePlayBtn.addEventListener('click', () => startBubbleGame());
  bubbleResetBtn.addEventListener('click', () => {
    stopBubbleGame();
    startBubbleGame();
  });

  // Obstacle Game (Mario style) with nicer shapes
  const canvas = document.getElementById('obstacle-canvas');
  const ctx = canvas.getContext('2d');
  const obstaclePlayBtn = document.getElementById('obstacle-play');
  const obstacleResetBtn = document.getElementById('obstacle-reset');
  const obstacleScoreEl = document.getElementById('obstacle-score');

  let runner = {
    x: 50,
    y: 0,
    width: 40,
    height: 60,
    velocityY: 0,
    gravity: 1.2,
    jumpForce: -18,
    grounded: false,
  };
  const groundLevel = canvas.height - runner.height;

  let obstacles = [];
  let obstacleSpeed = 6;
  let spawnTimer = 0;
  let spawnInterval = 90;
  let obstacleRunning = false;
  let score = 0;

  function drawRunner() {
    // Draw a Mario-style character: red hat and blue overalls simplified
    // Base body
    ctx.fillStyle = '#1565c0'; // blue overalls
    ctx.fillRect(runner.x + 5, runner.y + 20, runner.width - 10, runner.height - 20);

    // Shirt
    ctx.fillStyle = '#d32f2f'; // red shirt
    ctx.fillRect(runner.x, runner.y + 20, 10, runner.height - 20);

    // Head
    ctx.fillStyle = '#ffe0bd'; // skin color
    ctx.beginPath();
    ctx.ellipse(runner.x + runner.width / 2, runner.y + 10, 14, 18, 0, 0, Math.PI * 2);
    ctx.fill();

    // Hat
    ctx.fillStyle = '#d32f2f'; // red hat
    ctx.beginPath();
    ctx.ellipse(runner.x + runner.width / 2, runner.y + 2, 18, 10, 0, 0, Math.PI * 2);
    ctx.fill();

    // Hat brim
    ctx.fillStyle = '#b71c1c';
    ctx.fillRect(runner.x + 18, runner.y + 8, 20, 5);
  }

  function drawMushroom(x, y, width, height) {
    // Mushroom stem
    ctx.fillStyle = '#f5f5dc';
    ctx.fillRect(x + width*0.35, y + height*0.5, width * 0.3, height * 0.5);

    // Mushroom cap
    ctx.beginPath();
    ctx.ellipse(x + width*0.5, y + height*0.3, width*0.5, height*0.5, 0, 0, Math.PI*2);
    ctx.fillStyle = '#d32f2f';
    ctx.fill();

    // White dots on cap
    ctx.fillStyle = 'white';
    const dots = [
      [x + width*0.35, y + height*0.25],
      [x + width*0.60, y + height*0.15],
      [x + width*0.70, y + height*0.40],
      [x + width*0.45, y + height*0.45]
    ];
    dots.forEach(([cx, cy]) => {
      ctx.beginPath();
      ctx.ellipse(cx, cy, 5, 3.5, 0, 0, Math.PI * 2);
      ctx.fill();
    });
  }

  // Background gradient for aurora effect
  function drawAuroraBackground() {
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#0e3d59');
    gradient.addColorStop(0.3, '#1a5cc3');
    gradient.addColorStop(0.6, '#2a81f7');
    gradient.addColorStop(1, '#0e3d59');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw soft aurora lines
    for(let i=0; i<5; i++) {
      let x = (canvas.width/5)*i + 40;
      let gradientLine = ctx.createRadialGradient(x, 0, 20, x, canvas.height, 200);
      gradientLine.addColorStop(0, 'rgba(138, 255, 221, 0.3)');
      gradientLine.addColorStop(1, 'transparent');
      ctx.fillStyle = gradientLine;
      ctx.fillRect(x-100, 0, 200, canvas.height);
    }
  }

  // Shooting stars inside canvas for aurora theme
  let shootingStars = [];
  function createShootingStar() {
    shootingStars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height / 2,
      length: 100 + Math.random() * 50,
      speedX: 8 + Math.random() * 4,
      speedY: 3 + Math.random() * 2,
      opacity: 1,
      decay: 0.015 + Math.random() * 0.01,
    });
  }
  function updateShootingStars() {
    for(let i = shootingStars.length - 1; i >= 0; i--) {
      const s = shootingStars[i];
      s.x -= s.speedX;
      s.y += s.speedY;
      s.opacity -= s.decay;
      if(s.opacity <= 0 || s.x < 0 || s.y > canvas.height){
        shootingStars.splice(i,1);
      }
    }
  }
  function drawShootingStars() {
    shootingStars.forEach(s => {
      ctx.save();
      ctx.strokeStyle = "rgba(255,255,255,"+s.opacity.toFixed(2)+")";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(s.x, s.y);
      ctx.lineTo(s.x + s.length, s.y - s.length * 0.3);
      ctx.stroke();
      ctx.restore();
    });
  }

  setInterval(() => {
    if (obstacleRunning && shootingStars.length < 8) createShootingStar();
  }, 500);

  function resetObstacleGame(){
    runner.y = groundLevel;
    runner.velocityY = 0;
    runner.grounded = true;
    obstacles = [];
    spawnTimer = 0;
    score = 0;
    obstacleSpeed = 6;
    obstacleScoreEl.textContent = score;
  }

  function createObstacle(){
    const size = 50; // mushroom size
    obstacles.push({
      x: canvas.width,
      y: groundLevel + 10,
      width: size,
      height: size,
    });
  }

  function updateObstacle(){
    if(!obstacleRunning) return;

    drawAuroraBackground();
    updateShootingStars();
    drawShootingStars();

    // Draw ground
    ctx.fillStyle = '#1c2733';
    ctx.fillRect(0, groundLevel + runner.height, canvas.width, canvas.height - groundLevel);

    // Runner physics
    runner.velocityY += runner.gravity;
    runner.y += runner.velocityY;
    if(runner.y > groundLevel){
      runner.y = groundLevel;
      runner.velocityY = 0;
      runner.grounded = true;
    }

    // Draw runner character
    drawRunner();

    // Obstacles update and draw mushrooms
    spawnTimer++;
    if(spawnTimer >= spawnInterval){
      spawnTimer = 0;
      createObstacle();
    }

    for(let i = obstacles.length - 1; i >=0; i--){
      let obs = obstacles[i];
      obs.x -= obstacleSpeed;
      drawMushroom(obs.x, obs.y - obs.height, obs.width, obs.height);

      // Collision detection (AABB)
      if(runner.x < obs.x + obs.width &&
         runner.x + runner.width > obs.x &&
         runner.y + runner.height > obs.y - obs.height &&
         runner.y < obs.y){
          obstacleRunning = false;
          alert('Bạn đã va chạm cây nấm! Điểm: ' + score + '\nNhấn OK để chơi lại.');
          resetObstacleGame();
          obstaclePlayBtn.disabled = false;
          obstacleResetBtn.disabled = true;
          ctx.clearRect(0,0,canvas.width,canvas.height);
          return;
      }

      // Remove offscreen obstacle and increment score
      if(obs.x + obs.width < 0){
        obstacles.splice(i,1);
        score++;
        obstacleScoreEl.textContent = score;
        if(score % 10 === 0) obstacleSpeed += 0.5;
      }
    }
    requestAnimationFrame(updateObstacle);
  }

  function jumpObstacle(){
    if(runner.grounded){
      runner.velocityY = runner.jumpForce;
      runner.grounded = false;
    }
  }

  obstaclePlayBtn.addEventListener('click', () => {
    if(obstacleRunning) return;
    obstacleRunning = true;
    obstaclePlayBtn.disabled = true;
    obstacleResetBtn.disabled = false;
    resetObstacleGame();
    updateObstacle();
  });

  obstacleResetBtn.addEventListener('click', () => {
    obstacleRunning = false;
    obstaclePlayBtn.disabled = false;
    obstacleResetBtn.disabled = true;
    resetObstacleGame();
    ctx.clearRect(0,0,canvas.width,canvas.height);
  });

  document.addEventListener('keydown', e => {
    if(e.code === 'Space'){
      e.preventDefault();
      jumpObstacle();
    }
  });
  canvas.addEventListener('touchstart', e => {
    jumpObstacle();
  });

  // Music player controls
  const musicUrlInput = document.getElementById('music-url');
  const loadMusicBtn = document.getElementById('load-music');
  const musicContainer = document.getElementById('music-container');
  let currentIframe = null;

  loadMusicBtn.addEventListener('click', () => {
    const url = musicUrlInput.value.trim();
    if (!url) {
      alert('Vui lòng nhập URL hợp lệ!');
      return;
    }
    let embedUrl = null;

    if (url.includes('youtube.com') || url.includes('youtu.be')) {
      // Convert YouTube URL to embed format
      const videoIdMatch = url.match(/(youtu.be\/|v=|\/embed\/)([a-zA-Z0-9_-]{11})/);
      let videoId = null;
      if(videoIdMatch){
        videoId = videoIdMatch[2];
      } else {
        // Try to extract any ?v= param
        const urlObj = new URL(url);
        videoId = urlObj.searchParams.get('v');
      }
      if(videoId){
        embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1`;
      } else {
        alert('Không thể nhận dạng video YouTube. Vui lòng nhập URL thành các dạng chuẩn.');
        return;
      }
    } else if (url.includes('open.spotify.com')) {
      // Convert Spotify url to embed
      try {
        const urlObj = new URL(url);
        const parts = urlObj.pathname.split('/');
        if(parts.length >= 3){
          const type = parts[1];
          const id = parts[2];
          embedUrl = `https://open.spotify.com/embed/${type}/${id}`;
        }
      } catch {
        alert('URL Spotify không hợp lệ.');
        return;
      }
    } else {
      alert('Chỉ hỗ trợ URL YouTube và Spotify.');
      return;
    }

    if(embedUrl){
      musicContainer.innerHTML = '';
      const iframe = document.createElement('iframe');
      iframe.setAttribute('src', embedUrl);
      iframe.setAttribute('width', '100%');
      iframe.setAttribute('height', '80');
      iframe.setAttribute('frameborder', '0');
      iframe.setAttribute('allow', 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture');
      iframe.setAttribute('allowfullscreen', '');
      musicContainer.appendChild(iframe);
      currentIframe = iframe;
    }
  });
</script>
</body>
</html>

